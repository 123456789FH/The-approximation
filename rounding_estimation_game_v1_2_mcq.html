<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Ù„Ø¹Ø¨Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ ÙˆØªÙ‚Ø¯ÙŠØ± Ù†ÙˆØ§ØªØ¬ Ø§Ù„Ø¬Ù…Ø¹</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg1:#fef6e4; --bg2:#fde4f2; --bg3:#e8f7ff;
    --brand:#ff7aa2; --brand2:#6dd3ff; --accent:#ffc857; --success:#23d18b; --info:#6c8cff; --danger:#ff6b6b;
    --logo-h: 90px; /* â¬…ï¸ Ø­Ø¬Ù… Ø§Ù„Ø´Ø¹Ø§Ø± (ÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„Ù‡) */
  }
  body{ font-family:'Cairo',system-ui,-apple-system,Segoe UI,Roboto; background:
    radial-gradient(1200px 600px at 10% 0%, var(--bg2), transparent 60%),
    radial-gradient(1000px 600px at 90% 10%, var(--bg3), transparent 60%),
    radial-gradient(800px 500px at 50% 100%, var(--bg1), transparent 60%),
    linear-gradient(180deg, #fff, #fff 40%, #f9fbff 100%);
    min-height:100dvh; }
  .card{ backdrop-filter:saturate(140%) blur(6px);}
  .bubble{
    position:absolute; border-radius:9999px; opacity:.3; filter:blur(4px);
    animation: float 12s ease-in-out infinite;
  }
  .bubble.b1{ background:var(--brand2); width:120px; height:120px; top:10%; left:8%; animation-delay:0s}
  .bubble.b2{ background:var(--accent); width:90px; height:90px; top:70%; right:6%; animation-delay:2s}
  .bubble.b3{ background:var(--brand); width:150px; height:150px; bottom:6%; left:40%; animation-delay:4s}
  @keyframes float{ 0%,100%{ transform:translateY(0)} 50%{ transform:translateY(-14px)}}

  .pill{ box-shadow:0 6px 20px rgba(0,0,0,.08);}
  .btn-joy{ transition:transform .08s ease, box-shadow .2s ease, background .2s ease;}
  .btn-joy:active{ transform:translateY(1px); }
  .star {
    width: 18px; height: 18px; display:inline-block; margin:0 2px;
    background: conic-gradient(from 0deg, #ffd86b, #ffeaa7, #ffd86b);
    -webkit-mask: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="black" d="M316.9 18C311.6 7 300.4 0 288.1 0s-23.4 7-28.8 18L195 150.3 51.4 171.5c-12 1.8-22 10.2-25.7 21.7s-.7 24.2 7.9 32.7L137.8 329 113.2 474.7c-2 12 3 24.1 12.9 31.2s23 8 33.7 2.3l128.3-67.5 128.3 67.5c10.7 5.6 23.8 4.9 33.7-2.3s14.9-19.2 12.9-31.2L438.4 329l103.9-103.1c8.6-8.5 11.6-21.2 7.9-32.7s-13.7-19.9-25.7-21.7L381.3 150.3 316.9 18z"/></svg>') center/contain no-repeat;
            mask: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="black" d="M316.9 18C311.6 7 300.4 0 288.1 0s-23.4 7-28.8 18L195 150.3 51.4 171.5c-12 1.8-22 10.2-25.7 21.7s-.7 24.2 7.9 32.7L137.8 329 113.2 474.7c-2 12 3 24.1 12.9 31.2s23 8 33.7 2.3l128.3-67.5 128.3 67.5c10.7 5.6 23.8 4.9 33.7-2.3s14.9-19.2 12.9-31.2L438.4 329l103.9-103.1c8.6-8.5 11.6-21.2 7.9-32.7s-13.7-19.9-25.7-21.7L381.3 150.3 316.9 18z"/></svg>') center/contain no-repeat;
  }
  .tooltip{ position:relative }
  .tooltip:hover .tip { opacity:1; transform:translateY(0); pointer-events:auto; }
  .tip{
    position:absolute; bottom:120%; right:0; opacity:0; transform:translateY(6px);
    background:#0f172a; color:#fff; padding:.6rem .8rem; border-radius:.7rem; width:260px;
    box-shadow:0 12px 30px rgba(15,23,42,.25); transition:all .2s ease;
  }
  .tip:after{ content:""; position:absolute; top:100%; right:16px; border:8px solid transparent; border-top-color:#0f172a}
  .shake{ animation:shake .4s linear }
  @keyframes shake{ 0%,100%{ transform:translateX(0)} 25%{ transform:translateX(-4px)} 75%{ transform:translateX(4px)} }

  /* Ø´Ø§Ø±Ø© Ø§Ù„Ø´Ø¹Ø§Ø± Ø£Ø¹Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© - Ù…ÙƒØ¨Ø±Ø© */
  .brand-badge{ position:absolute; top:1rem; right:1rem; }
  .brand-badge img{ height:var(--logo-h); width:auto; filter: drop-shadow(0 6px 10px rgba(0,0,0,.15)); }

  /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±Ø§Øª */
  .choice{ border-width:1px; border-color:rgb(226 232 240); background:white; }
  .choice[aria-selected="true"]{ outline: 3px solid #22c55e; outline-offset: 2px; }
</style>
</head>
<body class="text-slate-800">
  <div class="bubble b1"></div>
  <div class="bubble b2"></div>
  <div class="bubble b3"></div>

  <!-- Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ù„ØªÙ‚Ù‰ (ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ± Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© Ø¨Ø³Ù‡ÙˆÙ„Ø©) -->
  <a class="brand-badge hidden md:block" href="https://t.me/ITG_KSA" target="_blank" rel="noopener" title="Ù‚Ù†Ø§Ø© Ø§Ù„Ù…Ù„ØªÙ‚Ù‰">
    <img src="https://d.top4top.io/p_35209x7gh1.png" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ù„ØªÙ‚Ù‰">
  </a>

  <main class="relative max-w-5xl mx-auto px-4 py-8">
    <header class="flex flex-col items-center text-center gap-3">
      <h1 class="text-3xl md:text-4xl font-extrabold bg-clip-text text-transparent"
          style="background-image:linear-gradient(90deg,var(--brand) 0%, var(--accent) 50%, var(--brand2) 100%);">
        Ù„Ø¹Ø¨Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ ÙˆØªÙ‚Ø¯ÙŠØ± Ù†ÙˆØ§ØªØ¬ Ø§Ù„Ø¬Ù…Ø¹
      </h1>
      <p class="text-slate-600 max-w-3xl">
        ØªØ¹Ù„Ù… ÙƒÙŠÙ Ù†Ù‚Ø±Ù‘Ø¨ Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¯ Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ø´Ø±Ø§Øª Ø£Ùˆ Ø§Ù„Ù…Ø¦Ø§ØªØŒ ÙˆÙ†Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…ØªÙ†Ø§ØºÙ…Ø© Ù„ØªÙ‚Ø¯ÙŠØ± Ø­Ø§ØµÙ„ Ø§Ù„Ø¬Ù…Ø¹ Ø¨Ø³Ø±Ø¹Ø© ÙˆØ°ÙƒØ§Ø¡.
      </p>
      <div class="flex gap-2 flex-wrap justify-center mt-1">
        <span class="pill inline-flex items-center gap-2 bg-white/70 border border-white text-slate-700 px-3 py-1.5 rounded-full">
          ğŸ¯ Ù‡Ø¯Ù Ø§Ù„Ø¯Ø±Ø³
          <span class="text-xs bg-slate-100 px-2 py-0.5 rounded-full">Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ + Ø§Ù„ØªÙ†Ø§ØºÙ…</span>
        </span>
        <span class="pill inline-flex items-center gap-2 bg-white/70 border border-white text-slate-700 px-3 py-1.5 rounded-full">
          â±ï¸ ÙˆÙ‚Øª Ø§Ù„Ù„Ø¹Ø¨
          <span class="text-xs bg-slate-100 px-2 py-0.5 rounded-full">5â€“7 Ø¯Ù‚Ø§Ø¦Ù‚</span>
        </span>
      </div>
    </header>

    <!-- Ù„ÙˆØ­Ø© Ø§Ù„Ø´Ø±Ø­ -->
    <section class="mt-6 grid md:grid-cols-2 gap-4">
      <div class="card bg-white/80 border border-white rounded-2xl p-5">
        <h2 class="font-bold text-lg flex items-center gap-2">Ù…Ø§ Ù…Ø¹Ù†Ù‰ Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ØŸ ğŸ“</h2>
        <p class="text-slate-700 mt-2">
          Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ ÙŠØ¹Ù†ÙŠ Ø£Ø®Ø° Ø¹Ø¯Ø¯ ÙˆØ¬Ø¹Ù„Ù‡ Ø£Ø³Ù‡Ù„ Ù„Ù„Ø­Ø³Ø§Ø¨Ø§ØªØŒ Ù…Ø¹ Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ù‚ÙŠÙ…ØªÙ‡ ØªÙ‚Ø±ÙŠØ¨ÙŠØ©. Ù†Ù†Ø¸Ø± Ø¥Ù„Ù‰ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ§Ù„ÙŠ:
        </p>
        <ul class="list-disc pr-5 mt-2 text-slate-700">
          <li>Ù†Ù‚Ø±Ù‘Ø¨ Ø¥Ù„Ù‰ Ø£Ù‚Ø±Ø¨ Ø¹Ø´Ø±Ø©: Ù†Ù†Ø¸Ø± Ø¥Ù„Ù‰ Ø®Ø§Ù†Ø© Ø§Ù„Ø¢Ø­Ø§Ø¯.</li>
          <li>Ù†Ù‚Ø±Ù‘Ø¨ Ø¥Ù„Ù‰ Ø£Ù‚Ø±Ø¨ Ù…Ø¦Ø©: Ù†Ù†Ø¸Ø± Ø¥Ù„Ù‰ Ø®Ø§Ù†Ø© Ø§Ù„Ø¹Ø´Ø±Ø§Øª.</li>
          <li>Ù¥ Ø£Ùˆ Ø£ÙƒØ«Ø±ØŸ Ù†Ø²ÙŠØ¯ Ø§Ù„Ø®Ø§Ù†Ø© Ø§Ù„ØªÙŠ Ù‚Ø¨Ù„Ù‡Ø§. Ø£Ù‚Ù„ Ù…Ù† Ù¥ØŸ Ù†Ø¨Ù‚ÙŠÙ‡Ø§ ÙƒÙ…Ø§ Ù‡ÙŠ.</li>
        </ul>
        <div class="mt-3 text-sm bg-slate-50 border border-slate-200 rounded-xl p-3">
          Ù…Ø«Ø§Ù„: 47 â‰ˆ 50 (Ù„Ø£Ù† 7 Ø®Ù…Ø³Ø© Ø£Ùˆ Ø£ÙƒØ«Ø±) â€“ 42 â‰ˆ 40 (Ù„Ø£Ù† 2 Ø£Ù‚Ù„ Ù…Ù† Ø®Ù…Ø³Ø©)
        </div>
      </div>

      <div class="card bg-white/80 border border-white rounded-2xl p-5">
        <h2 class="font-bold text-lg flex items-center gap-2">Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…ØªÙ†Ø§ØºÙ…Ø©ØŸ ğŸµ</h2>
        <p class="text-slate-700 mt-2">
          Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…ØªÙ†Ø§ØºÙ…Ø© Ù‡ÙŠ Ø£Ø¹Ø¯Ø§Ø¯ ÙŠØ³Ù‡Ù„ Ø¬Ù…Ø¹Ù‡Ø§ Ø³Ø±ÙŠØ¹Ù‹Ø§ Ù„Ø£Ù†Ù‡Ø§ ØªÙƒÙˆÙ† Ù‚Ø±ÙŠØ¨Ø© Ù…Ù† Ù…Ø¶Ø§Ø¹ÙØ§Øª 10 Ø£Ùˆ 100 Ø£Ùˆ ØªÙƒÙ…Ù„ Ø¨Ø¹Ø¶Ù‡Ø§ Ø§Ù„Ø¨Ø¹Ø¶.
        </p>
        <ul class="list-disc pr-5 mt-2 text-slate-700">
          <li>35 + 65 Ù…ØªÙ†Ø§ØºÙ…Ø§Ù† Ù„Ø£Ù† 35 + 65 = 100</li>
          <li>28 Ù‚Ø±ÙŠØ¨ Ù…Ù† 30 Ùˆ72 Ù‚Ø±ÙŠØ¨ Ù…Ù† 70 â‡’ 30 + 70 = 100 ØªÙ‚Ø¯ÙŠØ± Ø³Ø±ÙŠØ¹</li>
        </ul>
        <div class="mt-3 text-sm bg-slate-50 border border-slate-200 rounded-xl p-3">
          Ø§Ù„ÙÙƒØ±Ø©: Ù‚Ø±Ù‘Ø¨ Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¯ Ø¥Ù„Ù‰ Ù‚ÙŠÙ… Ø³Ù‡Ù„Ø© Ø«Ù… Ø§Ø¬Ù…Ø¹ Ù„ØªØ­ØµÙ„ Ø¹Ù„Ù‰ ØªÙ‚Ø¯ÙŠØ± Ø°ÙƒÙŠ ÙˆØ³Ø±ÙŠØ¹.
        </div>
      </div>
    </section>

    <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªØ­ÙƒÙ… -->
    <section class="mt-6 card bg-white/80 border border-white rounded-2xl p-5">
      <div class="flex flex-col md:flex-row items-stretch md:items-center justify-between gap-3">
        <div class="flex items-center gap-2">
          <span class="text-slate-700 font-semibold">ÙˆØ¶Ø¹ Ø§Ù„Ù„Ø¹Ø¨:</span>
          <div id="modeChips" class="flex gap-2 flex-wrap">
            <button data-mode="round10" class="mode btn-joy px-3 py-1.5 rounded-full bg-amber-100 text-amber-800 border border-amber-200">ØªÙ‚Ø±ÙŠØ¨ Ù„Ù„Ø¹Ø´Ø±Ø§Øª</button>
            <button data-mode="round100" class="mode btn-joy px-3 py-1.5 rounded-full bg-sky-100 text-sky-800 border border-sky-200">ØªÙ‚Ø±ÙŠØ¨ Ù„Ù„Ù…Ø¦Ø§Øª</button>
            <button data-mode="harmonic" class="mode btn-joy px-3 py-1.5 rounded-full bg-rose-100 text-rose-800 border border-rose-200">Ø£Ø¹Ø¯Ø§Ø¯ Ù…ØªÙ†Ø§ØºÙ…Ø©</button>
          </div>
        </div>
        <div class="flex items-center gap-2">
          <span class="text-slate-700 font-semibold">Ø§Ù„Ù…Ø³ØªÙˆÙ‰:</span>
          <select id="level" class="px-3 py-2 rounded-xl bg-white border border-slate-200 text-slate-700 focus:outline-none">
            <option value="easy">Ø³Ù‡Ù„</option>
            <option value="medium" selected>Ù…ØªÙˆØ³Ø·</option>
            <option value="hard">Ù…ØªÙ‚Ø¯Ù…</option>
          </select>
          <button id="newQ" class="btn-joy px-4 py-2 rounded-xl bg-gradient-to-l from-[var(--brand)] to-[var(--accent)] text-white font-semibold shadow-md hover:brightness-110">Ø³Ø¤Ø§Ù„ Ø¬Ø¯ÙŠØ¯ ğŸ”„</button>
        </div>
      </div>
    </section>

    <!-- Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø³Ø¤Ø§Ù„ ÙˆØ§Ù„Ù„Ø¹Ø¨ -->
    <section class="mt-6 grid lg:grid-cols-3 gap-4">
      <!-- Ø§Ù„Ø³Ø¤Ø§Ù„ -->
      <div class="lg:col-span-2 card bg-white/90 border border-white rounded-2xl p-5">
        <div class="flex items-start justify-between gap-2">
          <div>
            <h3 class="text-xl font-bold text-slate-800 flex items-center gap-2">Ø§Ù„ØªØ­Ø¯ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ âœ¨</h3>
            <p class="text-slate-600 text-sm mt-1" id="hintText">Ø§Ø®ØªØ± Ø§Ù„ÙˆØ¶Ø¹ ÙˆØ§Ø¶ØºØ· â€œØ³Ø¤Ø§Ù„ Ø¬Ø¯ÙŠØ¯â€.</p>
          </div>
          <div class="flex items-center gap-2">
            <div class="tooltip">
              <button id="helpBtn" class="btn-joy px-3 py-2 rounded-xl bg-slate-800 text-white text-sm">Ù…Ø³Ø§Ø¹Ø¯Ø© â“</button>
              <div class="tip" id="helpTip">
                Ø¬Ø±Ù‘Ø¨ ØªÙ‚Ø±ÙŠØ¨ ÙƒÙ„ Ø¹Ø¯Ø¯ Ø£ÙˆÙ„Ù‹Ø§ØŒ Ø«Ù… Ø§Ø¬Ù…Ø¹ Ø§Ù„Ù†ØªÙŠØ¬Ø©. Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ÙØ±Ù‚ ØµØºÙŠØ±Ù‹Ø§ØŒ ÙØ§Ù„ØªÙ‚Ø¯ÙŠØ± Ù…Ù…ØªØ§Ø²!
              </div>
            </div>
            <button id="ttsBtn" class="btn-joy px-3 py-2 rounded-xl bg-emerald-600 text-white text-sm">ğŸ”Š Ø§Ø³ØªÙ…Ø¹</button>
          </div>
        </div>

        <div class="mt-5 bg-gradient-to-br from-white to-slate-50 border border-slate-200 rounded-2xl p-5">
          <div id="questionBox" class="text-3xl md:text-4xl font-extrabold text-slate-900 tracking-tight text-center py-4">
            â€” â€” â€”
          </div>

          <!-- Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ -->
          <div class="grid md:grid-cols-3 gap-3 mt-3">
            <div class="p-3 rounded-xl bg-amber-50 border border-amber-100">
              <p class="text-sm font-semibold text-amber-800">ØªÙ‚Ø±ÙŠØ¨ Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙˆÙ„</p>
              <div class="flex items-center gap-2 mt-2">
                <button id="decA" class="btn-joy px-3 py-2 rounded-xl bg-white border border-slate-200">âˆ’</button>
                <input id="roundA" class="w-full text-center px-3 py-2 rounded-xl bg-white border border-slate-200" value="" placeholder="...">
                <button id="incA" class="btn-joy px-3 py-2 rounded-xl bg-white border border-slate-200">+</button>
              </div>
            </div>
            <div class="p-3 rounded-xl bg-sky-50 border border-sky-100">
              <p class="text-sm font-semibold text-sky-800">ØªÙ‚Ø±ÙŠØ¨ Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ø«Ø§Ù†ÙŠ</p>
              <div class="flex items-center gap-2 mt-2">
                <button id="decB" class="btn-joy px-3 py-2 rounded-xl bg-white border border-slate-200">âˆ’</button>
                <input id="roundB" class="w-full text-center px-3 py-2 rounded-xl bg-white border border-slate-200" value="" placeholder="...">
                <button id="incB" class="btn-joy px-3 py-2 rounded-xl bg-white border border-slate-200">+</button>
              </div>
            </div>
            <div class="p-3 rounded-xl bg-rose-50 border border-rose-100">
              <p class="text-sm font-semibold text-rose-800">ØªÙ‚Ø¯ÙŠØ± Ø­Ø§ØµÙ„ Ø§Ù„Ø¬Ù…Ø¹ (Ø§Ø®ØªØ± Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©)</p>
              <!-- Ø­Ù‚Ù„ Ù…Ø®ÙÙŠ Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„Ù‚ÙŠÙ…Ø© Ù„Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© -->
              <input id="sumGuess" type="hidden">
              <div id="mcq" class="grid grid-cols-2 gap-2 mt-2">
                <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±Ø§Øª ØªÙÙ…Ù„Ø£ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ -->
              </div>
            </div>
          </div>

          <!-- Ø§Ù„ØªØºØ°ÙŠØ© Ø§Ù„Ø±Ø§Ø¬Ø¹Ø© -->
          <div id="feedback" class="mt-4 hidden">
            <div id="fbBox" class="rounded-2xl p-4"></div>
          </div>
        </div>
      </div>

      <!-- Ù„ÙˆØ­Ø© Ø§Ù„Ù†Ù‚Ø§Ø· ÙˆØ§Ù„ØªÙ‚Ø¯Ù… -->
      <aside class="card bg-white/90 border border-white rounded-2xl p-5">
        <div class="flex items-center justify-between">
          <h3 class="font-bold text-lg">Ù„ÙˆØ­Ø© Ø§Ù„ØªÙ‚Ø¯Ù… ğŸ†</h3>
          <button id="resetBtn" class="btn-joy text-slate-700 text-sm bg-white border border-slate-200 px-3 py-1.5 rounded-lg">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙ‚Ø¯Ù…</button>
        </div>
        <div class="mt-3">
          <div class="flex items-center gap-2">
            <span class="text-slate-600">Ø§Ù„Ù†Ø¬ÙˆÙ…:</span>
            <div id="stars" class="flex"></div>
          </div>
          <div class="mt-3 text-slate-700">
            <div class="flex items-center justify-between">
              <span>Ø³Ù„Ø³Ù„Ø© Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø©:</span>
              <span id="streak" class="font-bold text-emerald-600">0</span>
            </div>
            <div class="flex items-center justify-between mt-1">
              <span>Ø£ÙØ¶Ù„ Ø³Ù„Ø³Ù„Ø©:</span>
              <span id="best" class="font-bold text-indigo-600">0</span>
            </div>
          </div>
          <div class="mt-4 bg-slate-50 border border-slate-200 rounded-xl p-3 text-sm text-slate-700">
            Ø§Ø¬Ù…Ø¹ 5 Ù†Ø¬ÙˆÙ… Ù„Ù„ÙÙˆØ² Ø¨Ø§Ù„Ø¬ÙˆÙ„Ø©! ÙƒÙ„ Ø¥Ø¬Ø§Ø¨Ø© Ù…Ù…ØªØ§Ø²Ø© ØªØ¹Ø·ÙŠÙƒ Ù†Ø¬Ù…Ø© âœ¨
          </div>
          <button id="celebrateBtn" class="mt-3 w-full btn-joy px-4 py-2 rounded-xl bg-gradient-to-l from-[var(--brand2)] to-[var(--accent)] text-white font-semibold">ğŸ‰ Ø§Ø­ØªÙØ§Ù„ ØµØºÙŠØ±</button>
        </div>
      </aside>
    </section>

    <!-- ØªØ­Ø¯ÙŠØ§Øª Ø¥Ø¶Ø§ÙÙŠØ© -->
    <section class="mt-6 card bg-white/80 border border-white rounded-2xl p-5">
      <h3 class="font-bold text-lg mb-2">ØªØ­Ø¯Ù Ø³Ø±ÙŠØ¹: Ø§Ø®ØªØ± Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…ØªÙ†Ø§ØºÙ…Ø© ğŸµ</h3>
      <p class="text-slate-600 text-sm">Ø§Ø®ØªØ± Ø§Ù„Ø²ÙˆØ¬ Ø§Ù„Ø£ÙƒØ«Ø± ØªÙ†Ø§ØºÙ…Ù‹Ø§ (Ø§Ù„Ø£Ù‚Ø±Ø¨ Ù„Ù…Ø¬Ù…ÙˆØ¹ 100 Ø£Ùˆ 1000) Ù„ØªØ­ØµÙ„ Ø¹Ù„Ù‰ Ù†Ø¬Ù…Ø© Ø¥Ø¶Ø§ÙÙŠØ©.</p>
      <div id="harmonicChoices" class="mt-3 grid sm:grid-cols-2 lg:grid-cols-4 gap-3">
        <!-- Ø®ÙŠØ§Ø±Ø§Øª ØªÙÙ…Ù„Ø£ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ -->
      </div>
    </section>

    <!-- Ù†Ø§ÙØ°Ø© ÙÙˆØ² -->
    <div id="winModal" class="fixed inset-0 hidden items-center justify-center p-4">
      <div class="absolute inset-0 bg-black/30"></div>
      <div class="relative z-10 bg-white rounded-2xl p-6 max-w-md w-full text-center">
        <h3 class="text-2xl font-extrabold">Ø±Ø§Ø¦Ø¹! Ø£Ù†Øª Ù†Ø¬Ù… Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ ğŸŒŸ</h3>
        <p class="text-slate-700 mt-2">Ø¬Ù…Ø¹Øª 5 Ù†Ø¬ÙˆÙ…. Ø§Ø³ØªÙ…Ø± ÙÙŠ Ø§Ù„Ù„Ø¹Ø¨ Ø£Ùˆ Ø§Ø¨Ø¯Ø£ Ø¬ÙˆÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø©!</p>
        <div class="mt-4 flex items-center justify-center gap-3">
          <button id="closeWin" class="btn-joy px-4 py-2 rounded-xl bg-slate-100 text-slate-800 border border-slate-200">Ù…ØªØ§Ø¨Ø¹Ø©</button>
          <button id="newRound" class="btn-joy px-4 py-2 rounded-xl bg-emerald-500 hover:bg-emerald-600 text-white font-semibold">Ø¬ÙˆÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
        </div>
      </div>
    </div>

    <footer class="text-center text-slate-600 text-sm mt-8 space-y-1">
      <div>Ø¨Ø±Ù…Ø¬Ø©: Ø£/ ÙØ§Ø·Ù…Ø© Ù‡Ø²Ø§Ø²ÙŠ Â· Ù…Ù„ØªÙ‚Ù‰ Ù…Ø¹Ù„Ù…ÙŠ ÙˆÙ…Ø¹Ù„Ù…Ø§Øª Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª Â· Ù…Ù„ØªÙ‚Ù‰ Ø§Ù„ØªØ¹Ù„ÙŠÙ… Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ</div>
      <div>Ù‚Ù†Ø§Ø© Ø§Ù„Ù…Ù„ØªÙ‚Ù‰: <a class="text-sky-700 hover:underline" href="https://t.me/ITG_KSA" target="_blank" rel="noopener">t.me/ITG_KSA</a></div>
    </footer>
  </main>

<script>
/* Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© */
const state = {
  mode: 'round10', // round10 | round100 | harmonic
  level: 'medium',
  a: null, b: null, // Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø£ØµÙ„ÙŠØ©
  targetRound: 10,  // Ø£Ø³Ø§Ø³ Ø§Ù„ØªÙ‚Ø±ÙŠØ¨
  stars: 0, streak: 0, best: 0
};

/* Ø£Ø¯ÙˆØ§Øª Ù…Ø³Ø§Ø¹Ø¯Ø© */
const $ = (sel)=>document.querySelector(sel);
const $$ = (sel)=>Array.from(document.querySelectorAll(sel));
const nf = new Intl.NumberFormat('ar-EG');

function rand(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }
function nearestBase(n, base){
  const down = Math.floor(n/base)*base;
  const up = Math.ceil(n/base)*base;
  // Ù‚Ø§Ø¹Ø¯Ø© 5 Ø£Ùˆ Ø£ÙƒØ«Ø± Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø¹Ù„Ù‰
  const mid = down + base/2;
  return (n>=mid)? up: down;
}
function formatPair(a,b){ return `${a.toLocaleString('ar-EG')} + ${b.toLocaleString('ar-EG')}`; }
function clampInputToStep(val, base){
  val = parseInt(val||0,10);
  if(isNaN(val)) return '';
  return Math.round(val/base)*base;
}

/* Ø¥Ù†Ø´Ø§Ø¡ Ø³Ø¤Ø§Ù„ Ø­Ø³Ø¨ Ø§Ù„ÙˆØ¶Ø¹ ÙˆØ§Ù„Ù…Ø³ØªÙˆÙ‰ */
function levelRange(level){
  switch(level){
    case 'easy': return [10, 99];
    case 'medium': return [50, 499];
    case 'hard': return [200, 1200];
  }
}
function genPairNearHarmony(to=100){
  const x = rand(10, to-10);
  const y = to - x + rand(-5,5); // Ù‚Ø±ÙŠØ¨ Ù…Ù† Ø§Ù„Ù…ÙƒÙ…Ù„
  return [Math.max(1,x), Math.max(1,y)];
}
function newQuestion(){
  const [min,max]=levelRange(state.level);
  if(state.mode==='harmonic'){
    // Ø£Ø¹Ø¯Ø§Ø¯ Ø¹Ø§Ø¯ÙŠØ© Ù„ÙƒÙ† ÙŠØ³Ù‡Ù„ Ø¬Ø¹Ù„Ù‡Ø§ Ù…ØªÙ†Ø§ØºÙ…Ø© Ø¨Ø¹Ø¯ Ø§Ù„ØªÙ‚Ø±ÙŠØ¨
    let [a,b]=genPairNearHarmony(state.level==='hard'?1000:100);
    // Ø§Ù†Ù‚Ù„ Ù„Ù„Ø£Ø·ÙŠØ§Ù Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù„Ù„Ù…Ø³ØªÙˆÙ‰
    a = clampToRange(a+rand(-20,20), min, max);
    b = clampToRange(b+rand(-20,20), min, max);
    state.a=a; state.b=b; state.targetRound = (state.level==='hard')?100:10;
    $('#hintText').textContent = 'Ø§Ø¨Ø­Ø« Ø¹Ù† ØªÙ†Ø§ØºÙ… Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¯ (ØªÙƒÙ…Ù„ Ø¥Ù„Ù‰ 100 Ø£Ùˆ 1000 Ø¨Ø¹Ø¯ Ø§Ù„ØªÙ‚Ø±ÙŠØ¨).';
  }else{
    state.targetRound = (state.mode==='round10')?10:100;
    let a = rand(min, max), b = rand(min, max);
    state.a=a; state.b=b;
    $('#hintText').textContent = state.mode==='round10'
      ? 'Ù‚Ø±Ù‘Ø¨ ÙƒÙ„ Ø¹Ø¯Ø¯ Ø¥Ù„Ù‰ Ø£Ù‚Ø±Ø¨ Ø¹Ø´Ø±Ø© Ø«Ù… Ø§Ø¬Ù…Ø¹.'
      : 'Ù‚Ø±Ù‘Ø¨ ÙƒÙ„ Ø¹Ø¯Ø¯ Ø¥Ù„Ù‰ Ø£Ù‚Ø±Ø¨ Ù…Ø¦Ø© Ø«Ù… Ø§Ø¬Ù…Ø¹.';
  }
  $('#questionBox').textContent = formatPair(state.a, state.b);
  // Ø¶Ø¨Ø· Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
  $('#roundA').value = nearestBase(state.a, state.targetRound);
  $('#roundB').value = nearestBase(state.b, state.targetRound);
  $('#sumGuess').value = '';
  hideFeedback();
  genHarmonicChoices();
  genMCQOptions();
}

function clampToRange(n,min,max){ return Math.min(max, Math.max(min,n)); }

/* ØªØºØ°ÙŠØ© Ø±Ø§Ø¬Ø¹Ø© */
function showFeedback({ok, title, detail, tip, delta}){
  const box = $('#fbBox');
  $('#feedback').classList.remove('hidden');
  box.className = 'rounded-2xl p-4';
  if(ok){
    box.classList.add('bg-emerald-50','border','border-emerald-200','text-emerald-800');
    box.innerHTML = `
      <div class="flex items-start gap-3">
        <div>âœ…</div>
        <div>
          <div class="font-bold">${title}</div>
          <div class="mt-1 text-sm">${detail}</div>
          ${tip? `<div class="mt-1 text-xs text-emerald-700/80">${tip}</div>`:''}
        </div>
      </div>`;
  }else{
    box.classList.add('bg-rose-50','border','border-rose-200','text-rose-800');
    box.innerHTML = `
      <div class="flex items-start gap-3">
        <div>âŒ</div>
        <div>
          <div class="font-bold">${title}</div>
          <div class="mt-1 text-sm">${detail}</div>
          ${tip? `<div class="mt-1 text-xs text-rose-700/80">${tip}</div>`:''}
        </div>
      </div>`;
  }
  // Ù†Ø¬ÙˆÙ… ÙˆØ§Ø­ØªÙØ§Ù„
  updateStars(ok ? (delta ?? 1) : 0);
}

/* Ø§Ù„ØªØ­Ù‚Ù‚ */
function checkAnswer(){
  const base = state.targetRound;
  const rA = clampInputToStep($('#roundA').value, base);
  const rB = clampInputToStep($('#roundB').value, base);
  const guess = parseInt($('#sumGuess').value||'NaN',10);

  // Ø§Ù„Ø­Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ÙŠ
  const modelA = nearestBase(state.a, base);
  const modelB = nearestBase(state.b, base);
  const modelSum = modelA + modelB;

  if(isNaN(guess)){
    showFeedback({
      ok:false,
      title:'Ø§Ø®ØªØ§Ø±ÙŠ Ø¥Ø¬Ø§Ø¨Ø© Ø£ÙˆÙ„Ù‹Ø§',
      detail:'Ø§Ø¶ØºØ·ÙŠ Ø¹Ù„Ù‰ Ø£Ø­Ø¯ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø£Ø±Ø¨Ø¹ ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„.',
      tip:'Ø£ÙƒÙ…Ù„ÙŠ Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ Ø£ÙˆÙ„Ù‹Ø§ Ø«Ù… Ø§Ø®ØªØ§Ø±ÙŠ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ØªÙ‚Ø¯ÙŠØ±ÙŠ.'
    });
    return;
  }

  // Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:
  const correctRounding = (rA===modelA && rB===modelB);
  const perfect = correctRounding && (guess===modelSum);
  const closeEnough = Math.abs(guess - modelSum) <= base;

  if(perfect){
    showFeedback({
      ok:true,
      title:'Ø¥Ø¬Ø§Ø¨Ø© Ù…Ù…ØªØ§Ø²Ø©! ğŸŒŸ',
      detail:`Ù‚Ù…ØªÙ Ø¨ØªÙ‚Ø±ÙŠØ¨ ${state.a.toLocaleString('ar-EG')} â†’ ${modelA.toLocaleString('ar-EG')} Ùˆ ${state.b.toLocaleString('ar-EG')} â†’ ${modelB.toLocaleString('ar-EG')}ØŒ ÙˆØ§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ØªÙ‚Ø¯ÙŠØ±ÙŠ = ${modelSum.toLocaleString('ar-EG')}.`,
      tip:'Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„ØªÙ‚Ø¯ÙŠØ± Ø§Ù„Ø£Ù…Ø«Ù„ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù‚Ø§Ø¹Ø¯Ø© 5 Ø£Ùˆ Ø£ÙƒØ«Ø± Ù†Ù‚Ø±Ù‘Ø¨ Ù„Ù„Ø£Ø¹Ù„Ù‰.',
      delta:1
    });
  }else if(correctRounding && closeEnough){
    showFeedback({
      ok:true,
      title:'Ø±Ø§Ø¦Ø¹! ØªÙ‚Ø¯ÙŠØ± Ù‚Ø±ÙŠØ¨ Ø¬Ø¯Ù‹Ø§ âœ…',
      detail:`ØªÙ‚Ø±ÙŠØ¨Ùƒ ØµØ­ÙŠØ­ ÙˆØ§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø°ÙŠ Ø§Ø®ØªØ±ØªÙ‡ Ù‚Ø±ÙŠØ¨ Ù…Ù† ${modelSum.toLocaleString('ar-EG')}.`,
      tip:'ÙƒÙ„Ù…Ø§ ÙƒØ§Ù† Ø§Ù„ÙØ±Ù‚ Ø£ØµØºØ± ÙƒØ§Ù† ØªÙ‚Ø¯ÙŠØ±Ùƒ Ø£Ø¯Ù‚.',
      delta:1
    });
  }else{
    // Ø´Ø±Ø­ ØªØµØ­ÙŠØ­ÙŠ
    let reason = [];
    if(rA!==modelA) reason.push(`Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙˆÙ„ ÙŠÙ†Ø¨ØºÙŠ ØªÙ‚Ø±ÙŠØ¨ÙÙ‡ Ø¥Ù„Ù‰ ${modelA.toLocaleString('ar-EG')}.`);
    if(rB!==modelB) reason.push(`Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ø«Ø§Ù†ÙŠ ÙŠÙ†Ø¨ØºÙŠ ØªÙ‚Ø±ÙŠØ¨ÙÙ‡ Ø¥Ù„Ù‰ ${modelB.toLocaleString('ar-EG')}.`);
    if(guess!==modelSum) reason.push(`Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ØªÙ‚Ø¯ÙŠØ±ÙŠ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ Ù‡Ùˆ ${modelSum.toLocaleString('ar-EG')}.`);
    showFeedback({
      ok:false,
      title:'ÙÙƒØ±Ø© Ø¬Ù…ÙŠÙ„Ø©ØŒ Ù„ÙƒÙ† ØªØ­ØªØ§Ø¬ ØªØ¹Ø¯ÙŠÙ„ Ø¨Ø³ÙŠØ·',
      detail:reason.join(' '),
      tip:`Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ¨: Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø±Ù‚Ù… ÙÙŠ Ø§Ù„Ø®Ø§Ù†Ø© Ø§Ù„ØªØ§Ù„ÙŠØ© ${base===10?'Ø§Ù„Ø¢Ø­Ø§Ø¯':'Ø§Ù„Ø¹Ø´Ø±Ø§Øª'} 5 Ø£Ùˆ Ø£ÙƒØ«Ø± Ù†Ø²ÙŠØ¯ØŒ ÙˆØ¥Ù„Ø§ Ù†Ø¨Ù‚ÙŠ ÙƒÙ…Ø§ Ù‡Ùˆ.`
    });
    // Ø¥Ø¹Ø§Ø¯Ø© ØªÙ…ÙŠÙŠØ² Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª
    highlightMCQ(guess, modelSum);
  }
}

/* Ø®ÙŠØ§Ø±Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø© Ù„Ù„Ù…Ø¬Ù…ÙˆØ¹ */
function genMCQOptions(){
  const base = state.targetRound;
  const modelA = nearestBase(state.a, base);
  const modelB = nearestBase(state.b, base);
  const modelSum = modelA + modelB;

  let opts = [modelSum, modelSum + base, modelSum - base, modelSum + 2*base];
  // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø³Ø§Ù„Ø¨Ø©/Ø§Ù„Ù…ÙƒØ±Ø±Ø©
  opts = Array.from(new Set(opts.filter(v => v > 0)));
  while(opts.length < 4){
    opts.push(modelSum + (rand(1,3) * base) * (Math.random() < .5 ? -1 : 1));
    opts = Array.from(new Set(opts.filter(v => v > 0)));
  }
  // Ø®Ù„Ø·
  opts.sort(()=>Math.random()-0.5);

  const box = $('#mcq');
  box.innerHTML = '';
  opts.forEach(v => {
    const btn = document.createElement('button');
    btn.className = 'choice btn-joy w-full text-center px-4 py-3 rounded-xl hover:bg-slate-50';
    btn.setAttribute('type','button');
    btn.textContent = new Intl.NumberFormat('ar-EG').format(v);
    btn.dataset.val = String(v);
    btn.addEventListener('click', () => {
      // ØªÙ…ÙŠÙŠØ² Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
      $$('#mcq .choice').forEach(c => c.setAttribute('aria-selected','false'));
      btn.setAttribute('aria-selected','true');
      // ØªÙ…Ø±ÙŠØ± Ø§Ù„Ù‚ÙŠÙ…Ø© ÙˆØ¥Ø¬Ø±Ø§Ø¡ Ø§Ù„ØªØ­Ù‚Ù‚
      $('#sumGuess').value = btn.dataset.val;
      checkAnswer();
    });
    box.appendChild(btn);
  });
}

function highlightMCQ(guess, correct){
  $$('#mcq .choice').forEach(c => {
    const val = parseInt(c.dataset.val, 10);
    c.style.outline = '';
    c.setAttribute('aria-selected', String(val === guess));
    if(val === correct){
      c.style.outline = '3px solid #22c55e';
      c.style.outlineOffset = '2px';
    }else if(val === guess){
      c.style.outline = '3px solid #ef4444';
      c.style.outlineOffset = '2px';
    }
  });
}

/* ØªÙ†Ø§ØºÙ… Ø§Ø®ØªÙŠØ§Ø±Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© */
function genHarmonicChoices(){
  const box = $('#harmonicChoices');
  box.innerHTML = '';
  const levelHard = (state.level==='hard');
  const target = levelHard?1000:100;

  // ØªÙˆÙ„ÙŠØ¯ 4 Ø®ÙŠØ§Ø±Ø§Øª: ÙˆØ§Ø­Ø¯ Ù…Ù†Ù‡Ø§ Ø§Ù„Ø£ÙƒØ«Ø± ØªÙ†Ø§ØºÙ…Ù‹Ø§
  const pairs = [];
  // Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„ØµØ­ÙŠØ­
  const good = genPairNearHarmony(target);
  pairs.push(good);
  // 3 Ù…Ø´ØªØªØ§Øª
  for(let i=0;i<3;i++){
    const a = rand(10, target-10);
    const b = rand(10, target-10);
    pairs.push([a,b]);
  }
  // Ø®Ù„Ø·
  pairs.sort(()=>Math.random()-0.5);

  pairs.forEach(([a,b])=>{
    const score = Math.abs((nearestBase(a, state.targetRound)) + (nearestBase(b, state.targetRound)) - target);
    const btn = document.createElement('button');
    btn.className = 'btn-joy w-full text-center px-4 py-3 rounded-xl bg-white border border-slate-200 hover:bg-slate-50';
    btn.textContent = `${nf.format(a)} + ${nf.format(b)}`;
    btn.dataset.score = score;
    btn.addEventListener('click', ()=>{
      const best = Math.min(...Array.from(box.children).map(c=>+c.dataset.score));
      if(score===best){
        showFeedback({
          ok:true,
          title:'Ø§Ø®ØªÙŠØ§Ø± Ù…ØªÙ†Ø§ØºÙ… Ø¬Ø¯Ù‹Ø§ ğŸµ',
          detail:`Ø¨Ø¹Ø¯ Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ ÙŠØµØ¨Ø­ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ù‚Ø±ÙŠØ¨Ù‹Ø§ Ù…Ù† ${nf.format(target)}. Ø£Ø­Ø³Ù†Øª!`,
          tip:'Ø§Ù„ØªÙ†Ø§ØºÙ… ÙŠØ¹Ù†ÙŠ Ø£Ø¹Ø¯Ø§Ø¯ ØªÙƒÙ…Ù„ Ù„Ø¨Ø¹Ø¶Ù‡Ø§ (Ù…Ø«Ù„ 35 Ùˆ65 â†’ 100).',
          delta:1
        });
      }else{
        showFeedback({
          ok:false,
          title:'Ù‚Ø±ÙŠØ¨ØŒ Ù„ÙƒÙ† Ù„ÙŠØ³ Ø§Ù„Ø£ÙƒØ«Ø± ØªÙ†Ø§ØºÙ…Ù‹Ø§',
          detail:`Ø§Ø¨Ø­Ø« Ø¹Ù† Ø²ÙˆØ¬ ÙŠÙ‚ØªØ±Ø¨ Ù…Ø¬Ù…ÙˆØ¹ÙÙ‡ Ø¨Ø¹Ø¯ Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ Ù…Ù† ${nf.format(target)}.`,
          tip:'ÙÙƒÙ‘Ø±: Ù‡Ù„ ÙŠÙƒÙ…Ù‘Ù„ Ø£Ø­Ø¯ Ø§Ù„Ø¹Ø¯Ø¯ÙŠÙ† Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ø¢Ø®Ø± Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù…Ø¶Ø§Ø¹Ù 10 Ø£Ùˆ 100ØŸ'
        });
      }
    });
    box.appendChild(btn);
  });
}

/* ØªÙ‚Ø¯Ù… ÙˆÙ†Ø¬ÙˆÙ… (Ù…Ø¹ Ø­ÙØ¸ Ø£ÙØ¶Ù„ Ø³Ù„Ø³Ù„Ø©) */
function updateStars(gain){
  if(gain){
    state.stars = Math.min(5, state.stars + gain);
    state.streak++;
    state.best = Math.max(state.best, state.streak);
  }
  const stars = $('#stars');
  stars.innerHTML = '';
  for(let i=0;i<5;i++){
    const s = document.createElement('span');
    s.className = 'star';
    s.style.opacity = i<state.stars ? '1' : '.2';
    stars.appendChild(s);
  }
  updateProgressView();
  if(state.stars>=5) openWin();
}

function updateProgressView(){
  $('#streak').textContent = state.streak;
  $('#best').textContent = state.best;
  // Ø­ÙØ¸ Ø£ÙØ¶Ù„ Ø³Ù„Ø³Ù„Ø© ÙÙŠ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
  localStorage.setItem('roundingGame_best', String(state.best));
}

function openWin(){
  $('#winModal').classList.remove('hidden');
  $('#winModal').classList.add('flex');
}

function closeWin(){
  $('#winModal').classList.add('hidden');
  $('#winModal').classList.remove('flex');
}

/* Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø­Ù‚ÙˆÙ„ (+/âˆ’) */
function stepInput(id, dir){
  const base = state.targetRound;
  const el = $(id);
  let val = parseInt(el.value||0,10);
  if(isNaN(val)) val = 0;
  val += dir*base;
  el.value = val;
}

/* Ù‚Ø±Ø§Ø¡Ø© ØµÙˆØªÙŠØ© Ù„Ù„Ø³Ø¤Ø§Ù„ */
function speakQuestion(){
  try{
    const txt = $('#questionBox').textContent.replace(/[^0-9Ù -Ù©\+\s]/g,'').trim();
    if(!txt) return;
    window.speechSynthesis.cancel();
    const u = new SpeechSynthesisUtterance('Ø§Ø­Ø³Ø¨ÙŠ Ø¨Ø§Ù„ØªÙ‚Ø±ÙŠØ¨: ' + txt.replace('+',' Ø²Ø§Ø¦Ø¯ '));
    u.lang = 'ar-SA';
    u.rate = 0.95;
    window.speechSynthesis.speak(u);
  }catch(e){ console.warn(e); }
}

/* Ø£Ø­Ø¯Ø§Ø« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© */
$('#modeChips').addEventListener('click', (e)=>{
  const btn = e.target.closest('button.mode');
  if(!btn) return;
  state.mode = btn.dataset.mode;
  // ØªÙ…ÙŠÙŠØ² Ù…Ø±Ø¦ÙŠ
  $$('.mode').forEach(b=>b.classList.remove('ring-2','ring-offset-2','ring-slate-800'));
  btn.classList.add('ring-2','ring-offset-2','ring-slate-800');
  newQuestion();
});

$('#level').addEventListener('change', (e)=>{
  state.level = e.target.value;
  newQuestion();
});

$('#newQ').addEventListener('click', ()=> newQuestion());

$('#decA').addEventListener('click', ()=> stepInput('#roundA', -1));
$('#incA').addEventListener('click', ()=> stepInput('#roundA', 1));
$('#decB').addEventListener('click', ()=> stepInput('#roundB', -1));
$('#incB').addEventListener('click', ()=> stepInput('#roundB', 1));

$('#resetBtn').addEventListener('click', ()=>{
  state.stars=0; state.streak=0; updateStars(0);
  hideFeedback();
});

$('#celebrateBtn').addEventListener('click', ()=>{
  confettiBurst();
});

$('#helpBtn').addEventListener('click', ()=>{
  // Ø¥Ø¸Ù‡Ø§Ø± ØªÙ„Ù…ÙŠØ­ ÙÙˆÙ‚ Ø§Ù„Ø²Ø± Ù„Ø«Ø§Ù†ÙŠØªÙŠÙ†
  const tip = $('#helpTip');
  tip.style.opacity = '1'; tip.style.transform='translateY(0)';
  setTimeout(()=>{ tip.style.opacity='0'; tip.style.transform='translateY(6px)'; }, 2000);
});

$('#ttsBtn').addEventListener('click', speakQuestion);

$('#closeWin').addEventListener('click', closeWin);
$('#newRound').addEventListener('click', ()=>{
  state.stars=0; state.streak=0; updateStars(0);
  closeWin(); newQuestion();
});

/* Ù…Ø¤Ø«Ø± Ø§Ø­ØªÙØ§Ù„ÙŠ Ø¨Ø³ÙŠØ· (Ù‚ØµØ§ØµØ§Øª) Ø¨Ø¯ÙˆÙ† Ù…ÙƒØªØ¨Ø§Øª */
function confettiBurst(){
  const N=24;
  const container = document.body;
  for(let i=0;i<N;i++){
    const p = document.createElement('div');
    p.style.position='fixed';
    p.style.top='-10px';
    p.style.left= (Math.random()*100)+'%';
    p.style.width='10px'; p.style.height='14px';
    p.style.background = ['#ff7aa2','#6dd3ff','#ffc857','#23d18b','#6c8cff'][i%5];
    p.style.transform='rotate('+ (Math.random()*360)+'deg)';
    p.style.borderRadius='3px';
    p.style.zIndex=50;
    p.style.opacity='0.9';
    const dur = 1200+Math.random()*1000;
    p.animate([
      { transform:`translateY(0) rotate(${Math.random()*90}deg)`, opacity:0.9 },
      { transform:`translate(${(Math.random()*80-40)}px, ${window.innerHeight+40}px) rotate(${Math.random()*360}deg)`, opacity:0.9 }
    ], { duration: dur, easing:'cubic-bezier(.2,.8,.2,1)'});
    container.appendChild(p);
    setTimeout(()=>p.remove(), dur);
  }
}

function hideFeedback(){
  $('#feedback').classList.add('hidden');
}

/* ØªÙ‡ÙŠØ¦Ø© */
window.addEventListener('load', ()=>{
  // Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø£ÙØ¶Ù„ Ø³Ù„Ø³Ù„Ø© Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
  const bestSaved = parseInt(localStorage.getItem('roundingGame_best')||'0',10);
  if(!Number.isNaN(bestSaved)) state.best = bestSaved;
  $('#best').textContent = state.best;

  // Ø§Ø®ØªÙŠØ§Ø± Ø§ÙØªØ±Ø§Ø¶ÙŠ
  $$('.mode')[0].classList.add('ring-2','ring-offset-2','ring-slate-800');
  newQuestion();
  updateStars(0);
});
</script>
</body>
</html>
